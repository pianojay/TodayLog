ì¼ë‹¨ êµ¬ì„± ì„±ë¶„ë“¤ì„ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ë„ë¡ í• ê²Œìš”.

https://docs.nav2.org/concepts/index.html

"Server" ê°€ ë­¡ë‹ˆê¹Œ?
ì¶”ìƒì ìœ¼ë¡œ ì„œë²„ëŠ” ì œê³µìì´ì£ . ê·¸ë¦¬ê³  ë…¸ë“œë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.
ê·¸ëŸ¬ë‹ˆê¹Œ íŠ¹ì •í•œ ì—­í• ì— ë”°ë¼ ë­”ê°€ë¥¼ í¼ë¸”ë¦¬ì‹œí•˜ëŠ” ë…¸ë“œì…ë‹ˆë‹¤.
âœ… ì •ë¦¬: "ì„œë²„"ëŠ” íŠ¹ì • ê¸°ëŠ¥ì˜ Action ì œê³µì ë…¸ë“œì´ë©°,
ROS2ì—ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ rclcpp_action::Server ê°ì²´ë¥¼ ë…¸ë“œ ë‚´ë¶€ì— í¬í•¨í•˜ì—¬ êµ¬í˜„ë©ë‹ˆë‹¤.
Modularí•œ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ ë³µì¡í•œ ë‚´ë¹„ê²Œì´ì…˜ íŒŒì´í”„ë¼ì¸ì„ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

Behavior Tree
ì¶”ìƒì ìœ¼ë¡œ Behavior TreeëŠ” ê±°ëŒ€í•œ if-thenì˜ tree graphë¼ê³  ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ graphì˜ node ë“¤ì€ ì§€ê°ê³¼ ë°˜ì‘, ê·¸ë¦¬ê³  fallback ë“±ì´ ìˆìŠµë‹ˆë‹¤. (íë¦„ë„ë¼ ìƒê°í•˜ë©´ ë¨)
Behavior TreeëŠ” BehaviorTree.CPPì— ì˜í•´ Nodeë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.
ì œ ìƒê°ì—ëŠ” ìì› ë‚­ë¹„ì¸ ê²ƒ ê°™ì•„ìš”. ê·¸ëƒ¥ ë©€í‹°í”Œë ‰ì„œ ë…¸ë“œ í•˜ë‚˜ë§Œ ë‘ë©´ ë˜ì–ì•„?? ê·¸ëƒ¥ global variable ê»ë‹¤ ì¼°ë‹¤ í•˜ê³  í™•ì¸í•˜ê³  í•˜ë©´ ë˜ì–ì•„?
ê·¸ëŸ¬ë‚˜, Behavior Treeë¥¼ ROS2 ë…¸ë“œë¡œ êµ¬í˜„í•œë‹¤ëŠ” ê²ƒì€ ê·¸ semanticì— ê´€ê±´ì´ ìˆì–´ìš”.
ì•„ì£¼ intuitive í•˜ê²Œ ë…¸ë“œë¥¼ ë…¸ë“œë¡œ êµ¬í˜„í•˜ë©´ ì•„ë¬´ë˜ë„ ìƒê°ì´ ì¤„ì–´ë“¤ì£ .
ì•„ë¬´íŠ¼ Behavior TreeëŠ” BTree.xmlë¡œ í˜•íƒœê°€ ì •ì˜ë˜ê³ , BehaviorTree_nodeì— ì˜í•´ ê´€ë¦¬ë˜ë©°, Action Serverë¡œ êµ¬í˜„ ë©ë‹ˆë‹¤.
ìì›ì„ ë§ì´ ë¨¹ì§€ëŠ” ì•Šë‚˜? ì‚¬ì‹¤ BTëŠ” ê°€ë²¼ìš´ í¸ì´ë¼ê³  í•©ë‹ˆë‹¤.
âœ… ì •ë¦¬: Behavior TreeëŠ” ë‹¨ìˆœíˆ ëª…ë ¹ íë¦„ì„ ì œì–´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,
ë³µì¡í•œ ë¯¸ì…˜ì„ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ì •ì˜í•˜ì—¬ ë°˜ì‘ì„±, ì¬ì‚¬ìš©ì„±, í‘œí˜„ë ¥ì„ í™•ë³´í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

Lifecycle
ROS2ì˜ ë…¸ë“œê°€ ì–¸ì œ ê¹¨ì–´ë‚˜ê³  ì–¸ì œ í™œë™ì„ ë©ˆì¶”ê³  í•˜ëŠ” ì§€ì— ëŒ€í•œ ê´€ë¦¬ì…ë‹ˆë‹¤. ê·¼ë° ì´ê±´ BehaviorTreeê°€ í•˜ëŠ” ê²Œ ì•„ë‹ˆëƒê³ ìš”?
ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ëŠ” "ì§€ê¸ˆ ë¬´ì—‡ì„ í•  ì§€"ì˜ ì§€ëŠ¥ì„ ê´€ë¦¬í•œë‹¤ê¸° ë³´ë‹¤ëŠ” ìì› ê´€ë¦¬(?)ì— ì´ˆì ì„ ë‘¡ë‹ˆë‹¤.
ë…¸ë“œê°€ í•„ìš”í•  ë•Œ ê¹¨ìš°ê³ (activate) í•„ìš” ì—†ìœ¼ë©´ ì¬ìš°ê³ (inactive) í•˜ëŠ” ê²ë‹ˆë‹¤.
ì•„ë¬´íŠ¼ Nav2ëŠ” ë…¸ë“œ ë° ì„œë²„ê°€ ì•„ì£¼ ë§ì•„ì§€ë¯€ë¡œ ìˆì–´ì•¼ í•˜ê³  ìˆì–´ì•¼ë§Œ ì œëŒ€ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì¼ì¼íˆ ê¹¨ìš°ê³  ì¬ìš°ëŠ” ê±¸ ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
âœ… ì •ë¦¬: Lifecycleì€ ROS2ì˜ ëª¨ë“ˆì  êµ¬ì¡°ì— ê¸°ë°˜í•œ ìƒíƒœ ê¸°ë°˜ ìì› ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ëª…ì‹œì ìœ¼ë¡œ ë…¸ë“œì˜ ì´ˆê¸°í™”Â·í•´ì œ ê³¼ì •ì„ ì œì–´í•˜ì—¬, ì‹œìŠ¤í…œ ì „ì²´ì˜ ì•ˆì •ì„±ê³¼ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤.

Navigation Servers
ì¶”ìƒì ìœ¼ë¡œ, ì´ë¡ ì ìœ¼ë¡œ navigationì˜ ìš”ì†Œë“¤ê³¼ ê·¸ ê¸°ëŠ¥ë“¤ì„ ìƒê°í•  ìˆ˜ ìˆëŠ”ë°, Nav2ë„ ì—¬ê¸°ì— ë§ì¶°ì„œ ê° ìš”ì†Œë“¤ì„ Server(=Node)ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
Planner, Smoother, Controller ë“±ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ ì™¸ì— Robot Footprints (/footprint) ë“±ë„ ìˆìŠµë‹ˆë‹¤.
ë‹¨, Estimation (localization), ê³§ tf: map->odom->base_linkëŠ” ì™¸ë¶€ ì…ë ¥ìœ¼ë¡œ ë°›ìœ¼ë©° ì—¬ê¸°ì—” robot_localization íŒ¨í‚¤ì§€ê°€ ì£¼ë¡œ ì“°ì…ë‹ˆë‹¤.
âœ… ì •ë¦¬: ê° ServerëŠ” í•˜ë‚˜ì˜ ëª©ì ì— ì§‘ì¤‘í•˜ëŠ” Action Providerì´ë©°, ROS2 êµ¬ì¡° ìƒ ë…ë¦½ëœ ë…¸ë“œë¡œ êµ¬í˜„ë¨.
ì˜ì¡´ì„± ë¶„ë¦¬ì™€ ë‹¤ì–‘í•œ ì•Œê³ ë¦¬ì¦˜ì˜ ëŒ€ì²´ ê°€ëŠ¥ì„±ì„ ì—¼ë‘ì— ë‘” ì„¤ê³„ì…ë‹ˆë‹¤.

Map, Costmap, Layer
Nav2ì—ì„œ Mapì€ staticí•œ ë°ì´í„°ë¡œ, ë§ ê·¸ëŒ€ë¡œ ì£¼ì–´ì§„ ì§€ë„ë¥¼ ë§í•©ë‹ˆë‹¤.
Costmapì€ Mapë¥¼ ê°€ê³µí•  ìˆ˜ë„ ìˆê³ , local sensor dataë¥¼ ë°›ì•„ì„œ ê°€ê³µ, ê³§ Occupancy Gridì˜ êµ¬í˜„ì…ë‹ˆë‹¤.
LayerëŠ” Map/Costmapì— ëŒ€í•œ ë‹¤ì–‘í•œ ì¸µìœ„ì˜ ë°ì´í„°ë¥¼ ë§í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê°™ì€ êµ¬ì—­ì— ëŒ€í•´ ë‹¤ì–‘í•œ ë²”ì£¼ì˜ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
âœ… ì •ë¦¬: Costmapì€ Layer ê¸°ë°˜ì˜ ê³„ì¸µì  êµ¬ì¡°ë¡œ, ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì¡°í•©í•´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
Layer ë°©ì‹ì€ ëª¨ë“ˆí™”, íš¨ìœ¨ì  ì—…ë°ì´íŠ¸, ì„ íƒì  ê°€ì‹œí™” ë“±ì„ ê°€ëŠ¥ì¼€ í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ìš”ì†Œê°€ ì—„ì²­ ë§ì€ ê²ƒ ê°™ì§€ë§Œ ì•Œê³  ë³´ë©´ ì›ë˜ í•´ì•¼ í•  ê²ƒì´ ë§ì•˜ë˜ ê²ƒì´ê³ , Nav2ëŠ” ê·¸ê²ƒì˜ êµ¬í˜„ì„ ìœ„í•´ êµ‰ì¥íˆ í¸ë¦¬í•˜ê²Œ ì„¤ê³„ë˜ì–´ ìˆë˜ ê²ƒì…ë‹ˆë‹¤.

Plugins
Serverê°€ "ë¬´ì—‡ì´ êµ¬í˜„ë  ê²ƒì¸ê°€?"(ex: Planner: costmap, goal poseë¥¼ ë°›ì•„ì„œ pathë¥¼ ë§Œë“¦) ì— ëŒ€í•œ ì¶”ìƒí™”ë¼ë©´,
Pluginì€ ë” êµ¬ì²´ì ì¸ ë‚´ìš©(ex: A*)ì˜ êµ¬í˜„ì…ë‹ˆë‹¤. ì¦‰, Serverì˜ ë‚´ìš©ì— í¬í•¨ë˜ë©°, config yamlì—ì„œ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ§© ë‚´ê°€ í”ŒëŸ¬ê·¸ì¸ì„ ë§Œë“¤ë ¤ë©´?
ì˜ˆ: Custom Global Planner ë§Œë“¤ê¸°.
1. nav2_core::GlobalPlannerë¥¼ ìƒì†
2. ë‹¤ìŒ ë©”ì„œë“œ êµ¬í˜„: configure(), activate(), deactivate(), cleanup(); createPlan(start, goal)
3. CMake ì„¤ì •:
    pluginlib_export_plugin_description_file(nav2_core ...)
    PLUGINLIB_EXPORT_CLASS(MyCustomPlanner, nav2_core::GlobalPlanner)
4. YAMLì— ë“±ë¡:
    MyPlanner:
        plugin: "my_package/MyCustomPlanner"


####
ROS2 with Nav2, map_server, global_costmap, planner_server;
For the purpose of autonomous rover traversal, (pre-)processing static map and local terrain information from depth camera:

A. Converting satellite lidar map to meaningful layers later to be used to generate costmap
B. Converting rgb-d to traversability (or occupancy) layer

Here I think I can utilize:
1. Slope vector (from discrete gradient calculation of height)
2. roughness (from variance data)
3. Local Traversability / Occupancy data (from rgb-d)

So the task is:
1. Define map layers and their roles (Slope vector,  roughness scalar... / What is the difference between traversability and occupancy? / What are the utile data I can get from them?)
2. Devise a method to convert the data available to each layers (For static map, it will be pre-computed and loaded as-is. For local data, it will be computed real time; Perhaps tf: camera->map will be used.)
3. Later, define a good penalty function to generate costmap so the rover can go through the terrain safely. (But later!)

What do you think?



ì„œë¡œ ë‹¤ë¥¸ í•´ìƒë„ì— ëŒ€í•œ ëŒ€ì²˜...
Staticì€ í˜„ì¬ 1m x 1m ë¡œ ì¤€ë¹„ë˜ì–´ ìˆë‹¤. ì´ì— ë”°ë¼ 3000 by 3000ì˜ ì •ë³´ë¥¼ ê°€ì§€ê²Œ ëœë‹¤. (~3km by ~3km)
ë­ í¬ê¸°ê°€ ë¬¸ì œë¼ê¸° ë³´ë‹¤ëŠ” í•´ìƒë„ì˜ ë¬¸ì œì´ë‹¤. ìŒ ì•„ë‹Œê°€?
ì´ë¯¸ .tif ë§µì˜ slope (x, y)ì™€ roughness ë°ì´í„°ë§Œ ëª¨ì•„ë„ 600MBì— ìœ¡ë°•í•œë‹¤.
ì´ê±¸ map_serverê°€ publish í•˜ë©´ í•˜ë“œì›¨ì–´ì ìœ¼ë¡œ ê°ë‹¹ì´ ë ê¹Œ?
ì•„ë§ˆ ìƒê°ë³´ë‹¤ ì‘ì„ ì§€ë„ ëª¨ë¥´ê² ë‹¤. ì–´ì°¨í”¼ 0~254ë¡œ normalize ë° ì¶•ì†Œë˜ì–´ì•¼ í•œë‹¤... (<- .pgm ì‚¬ìš© ê°€ëŠ¥)

ì¼ë‹¨ depth cameraëŠ” í•´ìƒë„ê°€ ì–´ëŠ ì •ë„ì¸ê°€? ê°€ë³€ì´ê¸´ í•œë° 0.05m x 0.05m ìˆ˜ì¤€.
depth cameraì˜ local dataëŠ” static mapì—ì„œ ë°˜ì˜ë˜ì§€ ì•ŠëŠ” ê²ƒì— ëŒ€í•œ ë³´ì¶©ì´ë‹¤.
ì¦‰: ë” ë‚˜ì€ í•´ìƒë„, ì‹ ê·œ ë°ì´í„°ë¥¼ ë°˜ì˜í•œë‹¤.

ê²°êµ­ roverê°€ ìƒê°í•´ì•¼ í•˜ëŠ” ê²ƒì€ "ê°€ë„ ì•ˆì „í•œê°€?"ì´ë©°,
ì´ê²ƒì€ slope (static and local), roughness (static), ê·¸ë¦¬ê³  obstacle (local)ì˜ ë°ì´í„°ë¡œ ì–»ì„ ìˆ˜ ìˆë‹¤.


"ê²°êµ­ roverê°€ ìƒê°í•´ì•¼ í•˜ëŠ” ê²ƒì€ "ê°€ë„ ì•ˆì „í•œê°€?"ì´ë‹¤.
ë‹¤ì‹œ ì •ë¦¬í•˜ë©´:
static slope + static roughness: ëª¨ë‘ preprocessingìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŒ.
local slope: ë§ˆì°¬ê°€ì§€ë¡œ discrete gradientë¡œ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.
local obstacle: discrete Laplacianìœ¼ë¡œ Obstacleì„ íŠ¹ì •í•  ìˆ˜ëŠ” ìˆë‹¤! ("íŠ¹ë³„íˆ íŠ€ì–´ë‚˜ì˜¨ ë¶€ë¶„" í•„í„°ë§ -> ì‚¬ìš©...?)
local dataì— likelihood ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ í•œë‹¤ë©´ í•  ìˆ˜ëŠ” ìˆì„ ê²ƒ ê°™ë‹¤.

ê·¸ëŸ°ë° Plannerë¥¼ ìœ„í•œ ìµœì¢… costmapì˜ í•´ìƒë„ë¥¼ ê²°ì •í•´ì•¼ ëœë‹¤. ì¼ë‹¨ local dataëŠ” ì œì¼ í˜„ì‹¤ê³¼ ê°€ê¹Œìš°ë¯€ë¡œ ì–´ë–¤ í˜•íƒœë¡œë“  ë°˜ì˜ì„ í•˜ëŠ” ê²ƒì´ ë§ë‹¤.
ë§Œì•½ mapì˜ í•´ìƒë„ì— ë§ì¶˜ë‹¤ë©´ í•œ ì¹´ë©”ë¼ì— ëŒ€í•´ í•œ ê°œ~ ë‘ ê°œ ì •ë„ì˜ cellì— ì˜í–¥ì„ ì£¼ê²Œ ëœë‹¤. ì´ê²ƒì´ ì¶©ë¶„í• ê¹Œ?
ì‚¬ì‹¤ 1m by 1m ìŠ¤í€˜ì–´ë¥¼ í”¼í•´ì„œ ëŒì•„ê°€ëŠ” ê²ƒì´ ê·¸ë ‡ê²Œ ë‚˜ì˜ì§€ëŠ” ì•Šì„ ìˆ˜ ìˆë‹¤. ì´ë¯¸ rover ê°€ 1m by 1mì´ë‹¤...

ê·¸ëŸ¬ë©´ ë‹¤ì‹œ ë” ì¤‘ìš”í•œ ê²ƒì´, depth cameraê°€ ì–¼ë§ˆë‚˜ ë©€ë¦¬ ë³¼ ìˆ˜ ìˆëŠ” ê°€ì˜ ë¬¸ì œì´ë‹¤. Intellisense D435ëŠ” ~.3m - 3m ì˜ depthë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤ê³  í™ë³´ë˜ê³  ìˆë‹¤.
ê·¸ëŸ¬ë©´ obstacleì„ í™•ì¸í•˜ëŠ” ê²ƒì— ì¶©ë¶„í•  ì§€ë„ ëª¨ë¥´ê² ë‹¤. cameraê°€ ë„ˆë¬´ ì•„ë˜ìª½ì„ ë³´ê³  ìˆì§€ë§Œ ì•Šìœ¼ë©´ ëœë‹¤.

ì´ë ‡ê²Œ ë†“ê³  ë³´ë©´ global costmapì˜ í•´ìƒë„ë¥¼ 1m by 1më¡œ í•´ë„ ê´œì°®ì•„ ë³´ì¸ë‹¤. local dataëŠ” ë¡œë´‡ ì£¼ë³€ì˜ ëª‡ í”½ì…€ë§Œ ë°”ê¾¸ì§€ë§Œ ê·¸ ì •ë„ë¡œë„ ìœ ìš©í•˜ë‹¤.


(rgb-dì˜ ê³ í•´ìƒë„ ë°ì´í„°ë¥¼ local costmapì— ë„£ê³  controllerì˜ íŒë‹¨ (ex: DWB)ì— ë§¡ê¸¸ ìˆ˜ë„ ìˆì§€ ì•Šì„ê¹Œ? ê°€ëŠ¥í•˜ë‹¤. ì‚¬ì‹¤ Nav2ì˜ ì„¤ê³„ê°€ ì´ê±¸ ë°”íƒ•ìœ¼ë¡œ í•œë‹¤.)
ê·¸ëŸ¬ë‚˜ ì¥ì†Œì— ì§ì ‘ ê°€ë³´ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì¦‰í¥ì ì¸ controllerì˜ íŒë‹¨ì— ë§¡ê¸°ê¸°ëŠ” ì–´ë ¤ì›Œ ë³´ì¸ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Plannerì™€ Controllerê°€ ê¾¸ì¤€íˆ ëŒ€ë¦½í•˜ë©´ ì˜ˆì¸¡í•˜ì§€ ëª»í•œ ì›€ì§ì„ì„ ë³´ì¼ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ, ì—…ë°ì´íŠ¸ ì£¼ê¸°ê°€ ë†’ì•„ì§€ë”ë¼ë„ ë°©ê¸ˆ ì•Œê²Œ ëœ ì •ë³´ë¥¼ Plannerì— ë°˜ì˜í•˜ëŠ” ê²Œ ì¢‹ì§€ ì•Šì„ê¹Œ?

ì´ëŠ” ë‚´ê°€ Regulated Pure Pursuit ê°™ì€ naive í•œ controllerì— ìµìˆ™í•´ì„œì¼ ì§€ë„ ëª¨ë¥´ê² ë‹¤. ì—¬ê¸°ì„œëŠ” PathëŠ” ì–¸ì œë‚˜ ì‹ ë¢°í•  ìˆ˜ ìˆìœ¼ë©°, ê·¸ëƒ¥ ì–Œì „íˆ ë”°ë¼ê°€ë©´ ëœë‹¤.


ë”°ë¼ì„œ static dataë¡œ global costmapë¥¼ ë§Œë“¤ë©°, local dataë¡œ global costmapì„ ì§ì ‘ amend í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•´ì„œ Planner ì— ì „ë‹¬í•˜ëŠ” ë°©ë²•ì´ ë‚«ë‹¤ê³  ìƒê°í–ˆë‹¤.
í•œí¸, local_costmap ë˜ëŠ” depth dataì˜ ë” ë†’ì€ í•´ìƒë„ê°€ ì•„ì˜ˆ ë¬´íš¨í•˜ì§€ëŠ” ì•Šë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Regulated Pure PursuitëŠ” Obstacle Proximity ë„ ë³´ê¸° ë•Œë¬¸ì´ë‹¤.



ë‹¤ì‹œ ì •ë¦¬í•˜ë©´:
static map -> slope, roughness -> global costmap
local data -> slope, obstacle -> amend global costmap



####
í•œë²ˆ data explorationì„ í•´ë³´ì.
gazeboì—ì„œ terrain ê°€ì ¸ì˜¤ê¸°:
https://classic.gazebosim.org/tutorials?tut=dem


.tif to .dem:

gdalì„ ì‚¬ìš©í•œë‹¤.
sudo apt install gdal-bin



